{% extends '_base.html' %} 
{% load static %} 

{% block body %}
        <div id="wrapper">
            
                {% include '_navbar.html' %} 
    
                {% include '_sidebar.html' %}

            <div id="page-content-wrapper">
                <div class="container">
                    <form id="form-body" action="{% url 'Demoscopesis:createPoll' %}" method="post" class="poll-form" role="form" data-parsley-validate novalidate>
						{% csrf_token %}
                        <div class="container-fluid shadow">
                            <div class="row">            
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="control-label control-label-left col-sm-3" for="field2">Title</label>
                                        <div id="title" class="controls">
                                            {{ PollForm.PL_TITLE }} 
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label control-label-left col-sm-3" for="field2">Short Body</label>
                                        <div id="shBody" class="controls">
                                            {{ PollForm.PL_SHRBODY }} 
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label control-label-left col-sm-3" for="field2">Body</label>
                                        <div id="body" class="controls">
                                            {{ PollForm.PL_BODY }} 
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label control-label-left col-sm-3" for="field2">Start Date</label>
                                        <div id="startDt" class="controls">
                                            {{ PollForm.PL_STARTDT }} 
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label control-label-left col-sm-3" for="field2">End Date</label>
                                        <div id="endDt" class="controls">
                                            {{ PollForm.PL_ENDDT }} 
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label control-label-left col-sm-3" for="field2">Code</label>
                                        <div id="code" class="controls">
                                            {{ PollForm.PL_CODE }} 
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label control-label-left col-sm-3" for="field2">Category</label>
                                        <div id="category" class="controls">
                                            {{ PollForm.POLLCAT }} 
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label control-label-left col-sm-3" for="field2">Voting Choices</label>
                                        <div id="choice" class="controls">
                                            <!-- This is where the hidden submitted form to django should be-->
                                            {{ PollChoiceFormSet }}
                                            <h3>Choices</h3>
                                            <!-- <input name="PL_SUBMIT" id="payload" class="form" type="text"> -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                    <div class="form-group text-center">
                        <div class="form-group text-center">
                            <button id="submit" type="button" class="btn btn-success" onclick="submitAll()">Submit</button>
                            <button id="cancel" type="button" class="btn btn-danger" onclick="window.history.back()">Cancel</button>
                            <button id="add" type="button" class="btn btn-secondary" onclick="addOption()">Add Option</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endblock %} 


{% block scripts %}
<script src="{% static "js/jquery-3.3.1.min.js"%}"></script>
<!-- <script src="{% static "js/jquery.formset.min.js"%}"></script>-->
<script src="{% static "js/bootstrap.bundle.min.js"%}"></script>
<script>
    // Sidebar functions
    $(function () {
        $('[data-toggle="popover"]').popover()
    })

    $("#menu-toggle").click(function (e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
    });

    // form field generator
    var optionGroup = document.getElementById("choice");
    var i = 0;

    function addOption(){
        var fieldWrapper = document.createElement("div");
                fieldWrapper.id = "choice" + i;
                fieldWrapper.className = "input-group mb-3";
            fieldWrapper.innerHTML =   `<input type="text" class="form-control target" placeholder="New Option" aria-label="Recipient's username" aria-describedby="basic-addon2">
                                        <div class="input-group-append">
                                            <button class="btn btn-outline-secondary" type="button" onclick="removeOption(`+ i +`)">X</button>
                                        </div>`;
        i++;
        optionGroup.appendChild(fieldWrapper);
    }

    function removeOption(rem){
        console.log("rem: " + rem)
        
        var remove = document.getElementById("choice"+rem)
        console.log(remove)
        document.getElementById("choice").removeChild(remove)
    }

    // Submit Contents
    function submitAll(){
        var stringBuilder = "";
        var inputs = document.getElementsByClassName("target");
        
        for(i = 0; i < inputs.length; i++){
            var link = inputs.item(i);
            if (i === 0){
                stringBuilder = stringBuilder + inputs.item(i).value;
            }else{
                stringBuilder = stringBuilder + "," + inputs.item(i).value;
            }
        }
        
        console.log(stringBuilder);
        document.getElementById("payload").value = stringBuilder;
        
        console.log(document.getElementById("form-body"))
        document.getElementById("form-body").submit();
    }
</script>
{% endblock %}